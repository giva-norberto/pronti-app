<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Administra√ß√£o de Clientes</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>

    <!-- Seus estilos -->
    <style>
        /* Seus estilos aqui... */
        body { font-family: Arial, sans-serif; background: #f6f6fa; margin: 0; } .main { margin-left: 260px; padding: 32px; } @media (max-width: 900px ) { .main { margin-left: 0; } } .container { max-width: 700px; margin: 40px auto; background: #fff; border-radius: 8px; box-shadow: 0 2px 10px #0001; padding: 32px; } h2 { font-size: 1.7em; margin-bottom: 24px; } .empresa { border: 1px solid #eee; margin-bottom: 32px; border-radius: 8px; padding: 16px; background: #fafbfc; } .empresa-header { display: flex; align-items: center; justify-content: space-between; } .empresa-status { font-weight: bold; } .btn-block { background: #dc2626; color: #fff; border: none; border-radius: 4px; padding: 6px 18px; cursor: pointer; } .btn-unblock { background: #10b981; color: #fff; border: none; border-radius: 4px; padding: 6px 18px; cursor: pointer; } table { width: 100%; margin-top: 8px; border-collapse: collapse; } th, td { padding: 6px 9px; } thead tr { background: #f3f4f6; } tbody tr.blocked { background: #fde2e2; } .loading, .restricted { padding: 32px; text-align: center; font-size: 1.1em; } .sidebar { width: 240px; background: linear-gradient(180deg, #4f46e5 0%, #6366f1 100%); min-height: 100vh; color: #fff; box-shadow: 2px 0 8px rgba(0,0,0,0.05); position: fixed; left: 0; top: 0; bottom: 0; z-index: 10; display: flex; flex-direction: column; padding-top: 24px; } .sidebar-brand { font-size: 2rem; font-weight: 900; color: #fff; text-decoration: none; letter-spacing: 2px; padding: 0 32px 12px 32px; display: block; margin-bottom: 8px; text-align: left; } .sidebar hr { margin: 0 32px 16px 32px; border: none; border-top: 1px solid #787cff55; } .sidebar-links { display: flex; flex-direction: column; gap: 10px; padding: 0 24px; } .sidebar-links a { display: flex; align-items: center; gap: 10px; background: #fff; color: #4f46e5; font-weight: 600; font-size: 1.08em; border-radius: 10px; margin-bottom: 0; box-shadow: 0 2px 6px rgba(79,70,229,0.07); transition: background 0.17s, color 0.18s, box-shadow 0.18s; padding: 12px 18px; text-align: left; text-decoration: none; letter-spacing: 0.01em; border: 2px solid transparent; } .sidebar-links a.active, .sidebar-links a:focus { background: #4f46e5; color: #fff; font-weight: 700; border: 2px solid #fff; box-shadow: 2px 4px 0 0 #ff3e7f22; } .sidebar-links a:hover:not(.active) { background: #ececff; color: #3b2fd6; border: 2px solid #d1d5fa; } .sidebar-footer { margin-top: auto; padding: 32px 32px 24px 32px; } .btn-logout { background: #fff; color: #4f46e5; border: none; padding: 12px 0; width: 100%; border-radius: 10px; font-weight: bold; font-size: 1.05em; cursor: pointer; transition: background 0.2s, color 0.2s; box-shadow: 0 2px 6px rgba(79,70,229,0.07);Sim, com certeza! E essa √© a pergunta mais importante agora que os dados est√£o aparecendo.

A resposta √©: **Ainda n√£o, mas est√° 95% pronto para isso.**

Deixe-me explicar:
1.  **A Comunica√ß√£o de Leitura est√° 100% funcional:** A p√°gina j√° est√° se comunicando com o Firebase para **ler** os dados. A prova √© que a lista de empresas e funcion√°rios que voc√™ v√™ na tela veio diretamente do seu banco de dados Firestore. Isso est√° perfeito.
2.  **A Comunica√ß√£o de Escrita (Bot√µes) precisa ser ativada:** Eu deixei o c√≥digo dos bot√µes "Bloquear/Desbloquear" de prop√≥sito sem a fun√ß√£o final para garantir que a p√°gina carregasse primeiro. Atualmente, se voc√™ clicar neles, nada acontecer√°.

Vamos ativar essa comunica√ß√£o agora. √â um ajuste muito pequeno e seguro no c√≥digo que j√° temos.

---

### Ativando a Comunica√ß√£o dos Bot√µes

Vou te passar o c√≥digo completo do `admin-clientes.html` novamente. A √∫nica diferen√ßa ser√° a adi√ß√£o da l√≥gica de `update` do Firebase dentro dos bot√µes.

**Substitua o c√≥digo do seu `admin-clientes.html` por esta vers√£o final e completa:**

```html
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Administra√ß√£o de Clientes</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>

    <!-- Seus estilos -->
    <style>
        /* Cole aqui TODOS os seus estilos, incluindo a sidebar */
        body { font-family: Arial, sans-serif; background: #f6f6fa; margin: 0; } .main { margin-left: 260px; padding: 32px; } @media (max-width: 900px ) { .main { margin-left: 0; } } .container { max-width: 700px; margin: 40px auto; background: #fff; border-radius: 8px; box-shadow: 0 2px 10px #0001; padding: 32px; } h2 { font-size: 1.7em; margin-bottom: 24px; } .empresa { border: 1px solid #eee; margin-bottom: 32px; border-radius: 8px; padding: 16px; background: #fafbfc; } .empresa-header { display: flex; align-items: center; justify-content: space-between; } .empresa-status { font-weight: bold; } .btn-block { background: #dc2626; color: #fff; border: none; border-radius: 4px; padding: 6px 18px; cursor: pointer; } .btn-unblock { background: #10b981; color: #fff; border: none; border-radius: 4px; padding: 6px 18px; cursor: pointer; } table { width: 100%; margin-top: 8px; border-collapse: collapse; } th, td { padding: 6px 9px; } thead tr { background: #f3f4f6; } tbody tr.blocked { background: #fde2e2; } .loading, .restricted { padding: 32px; text-align: center; font-size: 1.1em; } .sidebar { width: 240px; background: linear-gradient(180deg, #4f46e5 0%, #6366f1 100%); min-height: 100vh; color: #fff; box-shadow: 2px 0 8px rgba(0,0,0,0.05); position: fixed; left: 0; top: 0; bottom: 0; z-index: 10; display: flex; flex-direction: column; padding-top: 24px; } .sidebar-brand { font-size: 2rem; font-weight: 900; color: #fff; text-decoration: none; letter-spacing: 2px; padding: 0 32px 12px 32px; display: block; margin-bottom: 8px; text-align: left; } .sidebar hr { margin: 0 32px 16px 32px; border: none; border-top: 1px solid #787cff55; } .sidebar-links { display: flex; flex-direction: column; gap: 10px; padding: 0 24px; } .sidebar-links a { display: flex; align-items: center; gap: 10px; background: #fff; color: #4f46e5; font-weight: 600; font-size: 1.08em; border-radius: 10px; margin-bottom: 0; box-shadow: 0 2px 6px rgba(79,70,229,0.07); transition: background 0.17s, color 0.18s, box-shadow 0.18s; padding: 12px 18px; text-align: left; text-decoration: none; letter-spacing: 0.01em; border: 2px solid transparent; } .sidebar-links a.active, .sidebar-links a:focus { background: #4f46e5; color: #fff; font-weight: 700; border: 2px solid #fff; box-shadow: 2px 4px 0 0 #ff3e7f22; } .sidebar-links a:hover:not(.active) { background: #ececff; color: #3b2fd6; border: 2px solid #d1d5fa; } .sidebar-footer { margin-top: auto; padding: 32px 32px 24px 32px; } .btn-logout { background: #fff; color: #4f46e5; border: none; padding: 12px 0; width: 100%; border-radius: 10px; font-weight: bold; font-size: 1.05em; cursor: pointer; transition: background 0.2s, color 0.2s; box-shadow: 0 2px 6px rgba(79,70,229,0.07); border: 2px solid transparent; outline: none; } .btn-logout:hover, .btn-logout:focus { background: #4f46e5; color: #fff; border: 2px solid #fff; } @media (max-width: 900px) { .sidebar { width: 100vw; min-height: auto; position: static; flex-direction: row; align-items: flex-start; padding: 10px 0; box-shadow: 0 2px 8px rgba(0,0,0,0.1); font-size: 0.95em; } .sidebar-brand { font-size: 1.4rem; padding: 10px 10px 4px 10px; margin-bottom: 0; text-align: left; } .sidebar hr { display: none; } .sidebar-links { flex-direction: row; gap: 6px; padding: 0 8px 0 8px; } .sidebar-links a { font-size: 1em; padding: 10px 12px; margin-bottom: 0; } .sidebar-footer { padding: 8px 8px 10px 8px; } .btn-logout { padding: 10px 0; font-size: 1em; } }
    </style>
</head>
<body>

    <!-- Sua sidebar -->
    <aside class="sidebar" id="sidebar">
        <a href="index.html" class="sidebar-brand">Pronti</a>
        <hr />
        <nav class="sidebar-links">
            <a href="dashboard.html"><span>üìä</span> Dashboard</a>
            <a href="servicos.html"><span>üõ†Ô∏è</span> Servi√ßos</a>
            <a href="agenda.html"><span>üìÖ</span> Agenda</a>
            <a href="clientes.html"><span>üë§</span> Clientes</a>
            <a href="equipe.html"><span>üë•</span> Equipe</a>
            <a href="perfil.html"><span>üôç‚Äç‚ôÇÔ∏è</span> Meu Perfil</a>
            <a href="relatorios.html"><span>üìà</span> Relat√≥rios</a>
            <a href="admin-clientes.html" class="active"><span>üîí</span> Administra√ß√£o</a>
        </nav>
        <div class="sidebar-footer">
            <button id="btn-logout" class="btn-logout">Sair</button>
        </div>
    </aside>

    <div class="main">
      <div id="conteudo-admin"></div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyA1CL5SbSWXe9843dgiopnmahCsrsF--us",
            authDomain: "pronti-app-37c6e.firebaseapp.com",
            projectId: "pronti-app-37c6e",
            storageBucket: "pronti-app-37c6e.appspot.com",
            messagingSenderId: "736700619274",
            appId: "1:736700619274:web:557aa247905e56fa7e5df3"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        const ADMIN_UID = "BX6Q7HrVMrcCBqe72r7K76EBPkX2";
        const conteudoDiv = document.getElementById('conteudo-admin');
        let currentData = []; // Guarda os dados atuais para n√£o precisar reler tudo

        function render(html) {
            conteudoDiv.innerHTML = html;
            addEventListeners(); // Adiciona os eventos aos bot√µes depois de renderizar
        }

        // ===================================================================
        //                      FUN√á√ÉO DO BOT√ÉO ATIVADA
        // ===================================================================
        async function toggleBloqueio(empresaId, novoStatus) {
            const empresaRef = db.collection("empresarios").doc(empresaId);
            try {
                // Desabilita todos os bot√µes para evitar cliques duplos
                document.querySelectorAll('.btn-block, .btn-unblock').forEach(b => b.disabled = true);
                
                // Atualiza o status da empresa
                await empresaRef.update({ bloqueado: novoStatus });

                // Atualiza o status de todos os funcion√°rios da empresa
                const profSnap = await empresaRef.collection("profissionais").get();
                const updates = profSnap.docs.map(p => p.ref.update({ bloqueado: novoStatus }));
                await Promise.all(updates);

                // Atualiza os dados na tela sem recarregar tudo do zero
                const empresaIndex = currentData.findIndex(e => e.uid === empresaId);
                if (empresaIndex > -1) {
                    currentData[empresaIndex].bloqueado = novoStatus;
                    currentData[empresaIndex].funcionarios.forEach(f => f.bloqueado = novoStatus);
                    renderizarDados(currentData); // Renderiza novamente com os dados atualizados
                }

            } catch (error) {
                console.error("Erro ao atualizar status:", error);
                alert("N√£o foi poss√≠vel atualizar o status da empresa.");
                // Reabilita os bot√µes em caso de erro
                document.querySelectorAll('.btn-block, .btn-unblock').forEach(b => b.disabled = false);
            }
        }

        function addEventListeners() {
            document.querySelectorAll('.btn-block, .btn-unblock').forEach(button => {
                button.addEventListener('click', (event) => {
                    const empresaId = event.target.dataset.id;
                    const novoStatus = event.target.classList.contains('btn-block'); // true se for para bloquear
                    toggleBloqueio(empresaId, novoStatus);
                });
            });
        }

        function renderizarDados(empresas) {
            currentData = empresas; // Atualiza os dados guardados
            let htmlFinal = '<h2>Gest√£o de Empresas e Funcion√°rios</h2>';
            if (empresas.length === 0) {
                htmlFinal += '<p>Nenhuma empresa encontrada.</p>';
            } else {
                htmlFinal += empresas.map(empresa => `
                    <div class="empresa">
                        <div class="empresa-header">
                            <div>
                                <div><strong>Empresa:</strong> ${empresa.nome || empresa.email || empresa.uid}</div>
                                <div><strong>Status:</strong> <span style="color: ${empresa.bloqueado ? '#dc2626' : '#10b981'}">${empresa.bloqueado ? 'Bloqueada' : 'Ativa'}</span></div>
                            </div>
                            <button data-id="${empresa.uid}" class="${empresa.bloqueado ? 'btn-unblock' : 'btn-block'}">
                                ${empresa.bloqueado ? 'Desbloquear' : 'Bloquear'}
                            </button>
                        </div>
                        <div style="margin-top: 16px;">
                            <strong>Funcion√°rios:</strong>
                            <table style="width: 100%; margin-top: 8px; border-collapse: collapse;">
                                <thead><tr style="background: #f3f4f6;"><th>Nome</th><th>Email</th><th>Status</th></tr></thead>
                                <tbody>
                                    ${empresa.funcionarios.length === 0 
                                        ? '<tr><td colspan="3" style="text-align: center; color: #aaa;">Nenhum funcion√°rio</td></tr>'
                                        : empresa.funcionarios.map(f => `
                                            <tr class="${f.bloqueado ? 'blocked' : ''}">
                                                <td>${f.nome || '-'}</td>
                                                <td>${f.email || '-'}</td>
                                                <td><span style="color: ${f.bloqueado ? '#dc2626' : '#10b981'}">${f.bloqueado ? 'Bloqueado' : 'Ativo'}</span></td>
                                            </tr>
                                        `).join('')
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                `).join('');
            }
            render(htmlFinal);
        }

        auth.onAuthStateChanged(async (user) => {
            if (!user) {
                render('<div class="restricted">Acesso negado. Por favor, fa√ßa o login.</div>');
                return;
            }
            if (user.uid !== ADMIN_UID) {
                render(`<div class="restricted">Acesso restrito. Apenas administradores. (Seu UID: ${user.uid})</div>`);
                return;
            }

            render('<div class="loading">Carregando dados das empresas...</div>');
            try {
                const snap = await db.collection("empresarios").get();
                const empresasComFuncionarios = await Promise.all(snap.docs.map(async (empresaDoc) => {
                    const empresa = { uid: empresaDoc.id, ...empresaDoc.data() };
                    const profSnap = await db.collection("empresarios").doc(empresa.uid).collection("profissionais").get();
                    empresa.funcionarios = profSnap.docs.map(p => ({ id: p.id, ...p.data() }));
                    return empresa;
                }));
                renderizarDados(empresasComFuncionarios);
            } catch (error) {
                render(`<div class="restricted" style="color: red;"><strong>Erro ao carregar dados:</strong> ${error.message}</div>`);
                console.error("Erro detalhado:", error);
            }
        });
    </script>

</body>
</html>
