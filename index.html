<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pronti - In√≠cio</title>
    <link href="style.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* SEUS ESTILOS - SEM ALTERA√á√ÉO */
        .dashboard-body { background: linear-gradient(135deg, #1e3c72, #2a5298  ); min-height: 100vh; }
        body.is-loading { opacity: 0; }
        body { opacity: 1; transition: opacity 0.3s ease-in-out; }
        .primeiro-acesso-card { max-width: 400px; margin: 80px auto; padding: 36px 28px 32px 28px; border-radius: 22px; box-shadow: 0 8px 32px 0 rgba(31,38,135,0.17), 0 1.5px 6px #0001; background: linear-gradient(135deg, #e3ecfa 0%, #f7fafd 100%); border: 1.5px solid #e3eafc; text-align: center; }
        .primeiro-acesso-card h2 { color: #2563eb; font-weight: 700; font-size: 1.34rem; margin-bottom: 18px; }
        .primeiro-acesso-card p { font-size: 16px; color: #6b7a90; margin-bottom: 30px; }
        .primeiro-btn { display: block; width: 100%; background: linear-gradient(90deg, #2563eb 0%, #5b9eff 100%); color: #fff; font-weight: 600; border: none; border-radius: 8px; padding: 13px 0; font-size: 1rem; cursor: pointer; }
    </style>
</head>
<body class="dashboard-body is-loading">

<!-- =================================================================== -->
<!--                MENU LATERAL EMBUTIDO DIRETAMENTE AQUI               -->
<!-- =================================================================== -->
<aside class="sidebar">
    <div class="sidebar-header">
        <a href="index.html" class="sidebar-logo-link">
            <img src="logo-pronti-branca.png" alt="Logo Pronti" class="sidebar-logo">
        </a>
    </div>
    <nav class="sidebar-links">
        <a href="index.html" class="active"><span>üè†</span> In√≠cio</a>
        <a href="agenda.html"><span>üìÖ</span> Agenda</a>
        <a href="clientes.html"><span>üë•</span> Clientes</a>
        <a href="servicos.html"><span>‚úÇÔ∏è</span> Servi√ßos</a>
        <a href="profissionais.html"><span>üíá‚Äç‚ôÄÔ∏è</span> Profissionais</a>
        <a href="perfil.html"><span>‚öôÔ∏è</span> Configura√ß√µes</a>
    </nav>
    <div class="sidebar-footer">
        <button id="btn-logout" class="btn-logout"><span>üö™</span> Sair</button>
    </div>
</aside>
<!-- =================================================================== -->

<main class="main-content" id="main-content">
    <!-- O conte√∫do ser√° preenchido pelo script -->
</main>

<script type="module">
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { auth } from "./vitrini-firebase.js";
    import { verificarAcesso } from "./userService.js"; // Usando a vers√£o B√ÅSICA

    const mainContent = document.getElementById("main-content" );

    function mostrarPrimeiroAcessoCard() {
        mainContent.innerHTML = `
            <div class="primeiro-acesso-card">
                <h2>Seja bem-vindo ao Pronti!</h2>
                <p>Inicie o cadastro da sua empresa.</p>
                <button id="btn-criar-empresa" class="primeiro-btn"><i class="fa fa-building"></i> Criar minha empresa</button>
            </div>
        `;
        document.getElementById("btn-criar-empresa").addEventListener("click", () => {
            window.location.href = "perfil.html";
        });
    }

    function mostrarDashboard(perfil) {
        mainContent.innerHTML = `
            <div class="dashboard-welcome-center">
                <h1>Bem-vindo, ${perfil.nome || 'Usu√°rio'}!</h1>
                <p>Seu dashboard est√° funcionando.</p>
            </div>
        `;
    }

    // Ativa o bot√£o de logout que agora est√° no HTML principal
    document.getElementById('btn-logout').addEventListener('click', () => {
        signOut(auth).then(() => window.location.replace('login.html'));
    });

    onAuthStateChanged(auth, (user) => {
        if (user) {
            setTimeout(async () => {
                try {
                    const userSession = await verificarAcesso(); // Chama a vers√£o B√ÅSICA
                    mostrarDashboard(userSession.perfil);
                } catch (error) {
                    if (error.message === "primeiro_acesso") {
                        mostrarPrimeiroAcessoCard();
                    } else {
                        console.error("Erro fatal:", error);
                        mainContent.innerHTML = "<h1>Ocorreu um erro fatal. Verifique o console.</h1>";
                    }
                } finally {
                    document.body.classList.remove('is-loading');
                }
            }, 200);
        } else {
            window.location.replace('login.html');
        }
    });
</script>

</body>
</html>
