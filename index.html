<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pronti - Início</title>
    <link href="style.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* SEUS ESTILOS FICAM AQUI - SEM ALTERAÇÃO */
        .dashboard-body { background: linear-gradient(135deg, #1e3c72, #2a5298 ); min-height: 100vh; }
        /* ... (resto dos seus estilos) ... */
    </style>
</head>
<body class="dashboard-body is-loading">

<!-- SEU HTML FICA AQUI - SEM ALTERAÇÃO -->
<div id="sidebar-placeholder"></div>
<main class="main-content" id="main-content">
    <!-- ... (resto do seu HTML) ... -->
</main>

<script type="module">
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { auth } from "./vitrini-firebase.js";
    
    // ===================================================================
    //                      1ª CORREÇÃO APLICADA AQUI
    // ===================================================================
    // A importação da função 'ensureUserAndTrialDoc' foi removida, pois
    // ela não existe mais no nosso userService.js de teste.
    import { verificarAcesso } from "./userService.js";
    // ===================================================================

    // Suas constantes e funções originais (sem alteração )
    const nomeUsuarioSpan = document.getElementById("nome-usuario");
    // ... (resto das suas constantes e funções) ...
    function destacarLinkAtivo() { /* ... */ }
    function ativarLogout() { /* ... */ }
    function definirSaudacao() { /* ... */ }
    function mostrarPrimeiroAcessoCard() { /* ... */ }

    onAuthStateChanged(auth, (user) => {
        if (user) {
            setTimeout(async () => {
                try {
                    // ===================================================================
                    //                      2ª CORREÇÃO APLICADA AQUI
                    // ===================================================================
                    // A chamada para a função 'ensureUserAndTrialDoc' foi removida.
                    // await ensureUserAndTrialDoc(); // <--- LINHA REMOVIDA
                    // ===================================================================

                    const userSession = await verificarAcesso();
                    const { perfil, role } = userSession;

                    // O resto do seu código de sucesso (sem alteração)
                    if (role === 'funcionario') { /* ... */ }
                    // ... (resto da sua lógica) ...

                } catch (error) {
                    // Sua lógica de tratamento de erro (sem alteração)
                    if (error.message === "primeiro_acesso") {
                        mostrarPrimeiroAcessoCard();
                    } else {
                        console.error("Erro fatal na verificação de acesso:", error.message);
                    }
                }
            }, 200);
        } else {
            window.location.replace('login.html');
        }
    });
</script>

</body>
</html>
